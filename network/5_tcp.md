# TCP (Transmission Control Protocol)
- 패킷 유실 문제 해결
- 신뢰성 보장

## TCP 헤더
- IP패킷을 데이터 영역에 담고, TCP 헤더를 붙임
- 포함 내용 : 발신지 주소, 목적지 주소, 시퀀스 번호, 윈도 크기, 플래그
### 플래그 (flag)
- ACK(Acknowledgement) : 앞서 받은 데이터를 잘 처리했다는 의미
- SYN(Synchronize) : 나도 상대방에게 연결해도 되는지 연결 요청하는 의미
- FIN(Finish) : 통신이 마무리되어 연결의 해제를 요청하는 플래그

<br><br>

# 연결형 프로토콜
- 데이터를 주고 받기 전에 미리 클라이언트와 서버가 서로 통신할 준비가 됐는지 확인함
## 3방향 핸드셰이크(3-way handshake)
1. 클라이언트가 SYN 플래그를 씌워서 연결 요청을 시도함. 클라이언트는 SYN_SENT 상태가 됨
2. 서버는 연결을 할 수 있으면 클라이언트에게 ACK, SYN 플래그를 씌워서 패킷을 보냄. 서버는 SYN_RECEIVED 상태가 됨
3. 클라이언트는 서버에게 받은 ACK, SYN플래그가 있는 패킷을 확인하면, ACK 플래그를 씌운 패킷을 보내서 응답함. 클라이언트는 ESTABLISHED 상태가 됨
4. 서버가 클라이언트의 ACK응답을 받으면 서버는 ESTABLISHED 상태가 됨

## 4방향 핸드셰이크(4-way handshake)
1. 클라이언트가 서버한테 FIN을 보냄. 클라이언트는 FIN_WAIT 상태가 됨
2. 서버는 ACK로 응답하고 CLOSE_WAIT 함
3. 서버는 미처 보내지 못한 데이터가 있다면 마저 보냄 (여전히 CLOSE_WAIT 상태)
4. 서버는 FIN을 클라이언트에게 보내고, 클라이언트의 마지막 ACK를 기다림 (LAST_ACK 상태가 됨)
5. 클라이언트는 서버에게 ACK플래그가 담긴 패킷을 보내 연결을 종료함.
6. 클라이언트는 미처 받지 못한 패킷이 들어오는 등 혹시모를 상황에 대비해 잠시 기다림 (TIME_WAIT)
7. 서버는 클라이언트의 마지막 ACK를 받으면 CLOSE 상태가 됨
8. 일정 시간 기다린 클라이언트도 CLOSE 상태가 됨

<br><br>

# 흐름제어 (flow control)
## 의미
- 전송자와 수신자 간 데이터 속도 차이 발생가능
- 전송자가 수신자보다 빠르면 손실/오류 발생 가능
- 보내는 쪽이 받는 쪽의 속도에 맞춰서 주는 것
## 방식 1 : 정지-대기 방식 (stop and wait)
- 매 패킷에 대해 전송하고 확인 응답을 받음
- 전송자는 확인 응답을 받은 뒤 다음 패킷을 전송함. 일정시간 응답이 안오면 해당 패킷이 유실 됐다고 판단하고 다시 보냄
- 시간이 너무 오래 걸려서 잘 안씀
## 방식 2 : 슬라이딩 윈도 (sliding window)
- 전송자는 수신자가 받을 수 있는 만큼의 크기만큼 한번에 순서대로 전송함
- 그 크기를 윈도 크기(window size)라고 하며, 3-way 핸드셰이크 과정에서 이 크기가 정해짐
- 수신자는 받은 데이터를 처리하고 ACK 패킷을 보내는데, 마지막으로 받은 데이터의 번호가 몇번이었는지 전달함
- 전송자는 수신자가 보내온 마지막으로 받은 데이터 번호를 보고, 그 뒷 부분부터 다시 전달함

<br><br>

# 혼잡 제어 (congestion control)
## 의미
- 네트워크 상황에 따라 데이터의 처리 속도가 달라짐
- 네트워크 상황에 상관없이 전송자와 수신자가 무턱대고 유실된 데이터를 계속 다시 보내면, 네트워크가 더 혼잡해지고 더 느려지고 더 유실됨
- 네트워크 내 패킷 수가 과도하게 증가하는 현상을 혼잡이라고 하고, 이를 제어하는 기능을 혼잡 제어라고 함
## 제어 원리
- 전송자와 수신자는 처음부터 네트워크 상황을 알 수 없음
- 일단 데이터를 천천히 보내고, 수신자가 잘 받는 것을 확인하면 점차 더 빨리 보냄
- 그러다가 수신자가 한참 전에 전달한 데이터가지만 받았다고 얘기하면, 네트워크가 혼잡하다는 사실을 인지하고 속도를 줄임
## 방식 1 : 합 증가/곱 감소 (AIMD, Additive Increase/Multiplicative Decrease)
- 전송자는 수신자에게 패킷을 하나씩 보낸 뒤 잘 도착했다는 응받을 받으면 윈도 크기를 1개씩 증가시키며 전송함
- 1개씩 늘려다가가 네트워크가 혼잡하다고 판단되면 크기를 절반으로 줄임
- 네트워크가 괜찮은 것 같으면 다시 1개씩 늘려가면서 보냄
- 전송 속도가 천천히 증가하기 때문에 초기 전송 속도를 높이는 데 걸리는 시간이 길음
## 방식 2 : 느린 시작 (slow start)
- 윈도 크기를 1로 시작해서 2배씩 증가시킴
- 네트워크가 혼잡하다고 판단되면 윈도 크기를 1로 급격히 줄임
- 시간이 지날수록 많은 양의 데이터를 전달할 수 있음

<br><br>

# 키워드
- 신뢰성
- 연결형 프로토콜
- 헤더와 플래그
- 3방향 핸드셰이크
- 4방향 핸드셰이크
- 흐름제어 (flow control)
- 정지-대기 방식 (stop and wait)
- 슬라이딩 윈도(sliding window)
- 혼잡 제어

<br><br>

# UDP
- 신뢰성 보장 안해서 빠름
- 전송자와 수신자 사이에 연결을 보장하지 않음
- 전송자가 수신자에게 일방적으로 데이터를 전달함
- 비연결형 : 3-way handshake 같은 연결 확인 절차 없음
- 패킷 사이에 의존성 없음 : 패킷 순서 보장 안됨
- TCP보다 헤더에 정보가 적어서 용량이 작음
- 혼잡제어 불가
- 몇개 유실돼도 상관 없는 서비스에서 사용함
	- 예) 스트리밍, 온라인 게임